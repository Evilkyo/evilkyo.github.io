"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Sense = void 0;
const app = require(".");
class Sense {
    constructor(itemDefault = new app.core.GlowData(0, 110, 225, 25, true, false), itemHighlight = new app.core.GlowData(137, 108, 64, 0, true, false), maximumDistance = 300) {
        this.itemDefault = itemDefault;
        this.itemHighlight = itemHighlight;
        this.maximumDistance = maximumDistance;
    }
    resetItems(_, items) {
        for (const item of items) {
            if (item.highlightFunctionBits.value.isSame(this.itemHighlight)) {
                item.highlightFunctionBits.value = this.itemDefault;
            }
        }
    }
    resetPlayers(localPlayer, players) {
        for (const player of players) {
            if (player.isValid && !player.isSameTeam(localPlayer)) {
                if (this.inRange(localPlayer, player.localOrigin)) {
                    /* This could be a Bloodhound scan! */
                }
                else if (player.glowEnable.value === 7 || player.glowEnable.value === 5) {
                    player.glowEnable.value = 5;
                    player.glowThroughWalls.value = 1;
                }
            }
        }
    }
    updateItems(localPlayer, items, itemSet) {
        for (const item of items) {
            if (itemSet.has(item.customScriptInt.value) && this.inRange(localPlayer, item.localOrigin)) {
                item.highlightFunctionBits.value = this.itemHighlight;
            }
            else if (item.highlightFunctionBits.value.isSame(this.itemHighlight)) {
                item.highlightFunctionBits.value = this.itemDefault;
            }
        }
    }
    updatePlayers(localPlayer, players, options) {
        for (const player of players) {
            if (player.isValid && !player.isSameTeam(localPlayer)) {
                const range = this.range(localPlayer, player.localOrigin);
                if (range < this.maximumDistance) {
                    if (options && options.longRangeMode && range > 50 && localPlayer.zooming.value == 1) {
                        player.glowEnable.value = 5;
                        player.glowThroughWalls.value = 1;
                    }
                    else {
                        player.glowEnable.value = 5;
                        player.glowThroughWalls.value = 1;
                    }
                }
                else if (player.glowEnable.value === 7 || player.glowEnable.value === 5) {
                    player.glowEnable.value = 5;
                    player.glowThroughWalls.value = 1;
                }
            }
        }
    }
    inRange(localPlayer, origin) {
        const dx = (localPlayer.localOrigin.value.x - origin.value.x) * 0.0254;
        const dy = (localPlayer.localOrigin.value.y - origin.value.y) * 0.0254;
        return Math.sqrt(Math.pow(dx, 2) + Math.pow(dy, 2)) < this.maximumDistance;
    }
    range(localPlayer, origin) {
        const dx = (localPlayer.localOrigin.value.x - origin.value.x) * 0.0254;
        const dy = (localPlayer.localOrigin.value.y - origin.value.y) * 0.0254;
        return Math.sqrt(Math.pow(dx, 2) + Math.pow(dy, 2));
    }
}
exports.Sense = Sense;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2Vuc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGliL2ZlYXR1cmVzL1NlbnNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHlCQUF5QjtBQUV6QixNQUFhLEtBQUs7SUFDaEIsWUFDbUIsY0FBYyxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLEVBQ2pFLGdCQUFnQixJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLEVBQ25FLGtCQUFrQixHQUFHO1FBRnJCLGdCQUFXLEdBQVgsV0FBVyxDQUFzRDtRQUNqRSxrQkFBYSxHQUFiLGFBQWEsQ0FBc0Q7UUFDbkUsb0JBQWUsR0FBZixlQUFlLENBQU07SUFBSSxDQUFDO0lBRTdDLFVBQVUsQ0FBQyxDQUFrQixFQUFFLEtBQThCO1FBQzNELEtBQUssTUFBTSxJQUFJLElBQUksS0FBSyxFQUFFO1lBQ3hCLElBQUksSUFBSSxDQUFDLHFCQUFxQixDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxFQUFFO2dCQUMvRCxJQUFJLENBQUMscUJBQXFCLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7YUFDckQ7U0FDRjtJQUNILENBQUM7SUFFRCxZQUFZLENBQUMsV0FBNEIsRUFBRSxPQUFrQztRQUMzRSxLQUFLLE1BQU0sTUFBTSxJQUFJLE9BQU8sRUFBRTtZQUM1QixJQUFJLE1BQU0sQ0FBQyxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxFQUFFO2dCQUNyRCxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLE1BQU0sQ0FBQyxX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QUFHLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQztJQUM3RSxDQUFDO0lBRU8sS0FBSyxDQUFDLFdBQTRCLEVBQUUsTUFBdUI7UUFDakUsTUFBTSxFQUFFLEdBQUcsQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUM7UUFDdkUsTUFBTSxFQUFFLEdBQUcsQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUM7UUFDdkUsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDdEQsQ0FBQztDQUNGO0FBcEVELHNCQW9FQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGFwcCBmcm9tICcuJztcblxuZXhwb3J0IGNsYXNzIFNlbnNlIHtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZWFkb25seSBpdGVtRGVmYXVsdCA9IG5ldyBhcHAuY29yZS5HbG93RGF0YSgwLCAxMTAsIDIyNSwgMjUsIHRydWUsIGZhbHNlKSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IGl0ZW1IaWdobGlnaHQgPSBuZXcgYXBwLmNvcmUuR2xvd0RhdGEoMTM3LCAxMDgsIDY0LCAwLCB0cnVlLCBmYWxzZSksXG4gICAgcHJpdmF0ZSByZWFkb25seSBtYXhpbXVtRGlzdGFuY2UgPSAzMDApIHsgfVxuXG4gIHJlc2V0SXRlbXMoXzogYXBwLmNvcmUuUGxheWVyLCBpdGVtczogSXRlcmFibGU8YXBwLmNvcmUuSXRlbT4pIHtcbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbXMpIHtcbiAgICAgIGlmIChpdGVtLmhpZ2hsaWdodEZ1bmN0aW9uQml0cy52YWx1ZS5pc1NhbWUodGhpcy5pdGVtSGlnaGxpZ2h0KSkge1xuICAgICAgICBpdGVtLmhpZ2hsaWdodEZ1bmN0aW9uQml0cy52YWx1ZSA9IHRoaXMuaXRlbURlZmF1bHQ7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmVzZXRQbGF5ZXJzKGxvY2FsUGxheWVyOiBhcHAuY29yZS5QbGF5ZXIsIHBsYXllcnM6IEl0ZXJhYmxlPGFwcC5jb3JlLlBsYXllcj4pIHtcbiAgICBmb3IgKGNvbnN0IHBsYXllciBvZiBwbGF5ZXJzKSB7XG4gICAgICBpZiAocGxheWVyLmlzVmFsaWQgJiYgIXBsYXllci5pc1NhbWVUZWFtKGxvY2FsUGxheWVyKSkge1xuICAgICAgICBpZiAodGhpcy5pblJhbmdlKGxvY2FsUGxheWVyLCBwbGF5ZXIubG9jYWxPcmlnaW4pKSB7XG4gICAgICAgICAgLyogVGhpcyBjb3VsZCBiZSBhIEJsb29kaG91bmQgc2NhbiEgKi9cbiAgICAgICAgfSBlbHNlIGlmIChwbGF5ZXIuZ2xvd0VuYWJsZS52YWx1ZSA9PT0gNyB8fCBwbGF5ZXIuZ2xvd0VuYWJsZS52YWx1ZSA9PT0gNSkge1xuICAgICAgICAgIHBsYXllci5nbG93RW5hYmxlLnZhbHVlID0gNTtcbiAgICAgICAgICBwbGF5ZXIuZ2xvd1Rocm91Z2hXYWxscy52YWx1ZSA9IDE7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICB1cGRhdGVJdGVtcyhsb2NhbFBsYXllcjogYXBwLmNvcmUuUGxheWVyLCBpdGVtczogSXRlcmFibGU8YXBwLmNvcmUuSXRlbT4sIGl0ZW1TZXQ6IFNldDxudW1iZXI+KSB7XG4gICAgZm9yIChjb25zdCBpdGVtIG9mIGl0ZW1zKSB7XG4gICAgICBpZiAoaXRlbVNldC5oYXMoaXRlbS5jdXN0b21TY3JpcHRJbnQudmFsdWUpICYmIHRoaXMuaW5SYW5nZShsb2NhbFBsYXllciwgaXRlbS5sb2NhbE9yaWdpbikpIHtcbiAgICAgICAgaXRlbS5oaWdobGlnaHRGdW5jdGlvbkJpdHMudmFsdWUgPSB0aGlzLml0ZW1IaWdobGlnaHQ7XG4gICAgICB9IGVsc2UgaWYgKGl0ZW0uaGlnaGxpZ2h0RnVuY3Rpb25CaXRzLnZhbHVlLmlzU2FtZSh0aGlzLml0ZW1IaWdobGlnaHQpKSB7XG4gICAgICAgIGl0ZW0uaGlnaGxpZ2h0RnVuY3Rpb25CaXRzLnZhbHVlID0gdGhpcy5pdGVtRGVmYXVsdDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICB1cGRhdGVQbGF5ZXJzKGxvY2FsUGxheWVyOiBhcHAuY29yZS5QbGF5ZXIsIHBsYXllcnM6IEl0ZXJhYmxlPGFwcC5jb3JlLlBsYXllcj4sIG9wdGlvbnM/OiBJU2Vuc2VPcHRpb25zKSB7XG4gICAgZm9yIChjb25zdCBwbGF5ZXIgb2YgcGxheWVycykge1xuICAgICAgaWYgKHBsYXllci5pc1ZhbGlkICYmICFwbGF5ZXIuaXNTYW1lVGVhbShsb2NhbFBsYXllcikpIHtcbiAgICAgICAgY29uc3QgcmFuZ2UgPSB0aGlzLnJhbmdlKGxvY2FsUGxheWVyLCBwbGF5ZXIubG9jYWxPcmlnaW4pO1xuICAgICAgICBpZiAocmFuZ2UgPCB0aGlzLm1heGltdW1EaXN0YW5jZSkge1xuICAgICAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMubG9uZ1JhbmdlTW9kZSAmJiByYW5nZSA+IDUwICYmIGxvY2FsUGxheWVyLnpvb21pbmcudmFsdWUgPT0gMSkge1xuICAgICAgICAgICAgcGxheWVyLmdsb3dFbmFibGUudmFsdWUgPSA1O1xuICAgICAgICAgICAgcGxheWVyLmdsb3dUaHJvdWdoV2FsbHMudmFsdWUgPSAxO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwbGF5ZXIuZ2xvd0VuYWJsZS52YWx1ZSA9IDU7XG4gICAgICAgICAgICBwbGF5ZXIuZ2xvd1Rocm91Z2hXYWxscy52YWx1ZSA9IDE7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHBsYXllci5nbG93RW5hYmxlLnZhbHVlID09PSA3IHx8IHBsYXllci5nbG93RW5hYmxlLnZhbHVlID09PSA1KSB7XG4gICAgICAgICAgcGxheWVyLmdsb3dFbmFibGUudmFsdWUgPSA1O1xuICAgICAgICAgIHBsYXllci5nbG93VGhyb3VnaFdhbGxzLnZhbHVlID0gMTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaW5SYW5nZShsb2NhbFBsYXllcjogYXBwLmNvcmUuUGxheWVyLCBvcmlnaW46IGFwcC5jb3JlLlZlY3Rvcikge1xuICAgIGNvbnN0IGR4ID0gKGxvY2FsUGxheWVyLmxvY2FsT3JpZ2luLnZhbHVlLnggLSBvcmlnaW4udmFsdWUueCkgKiAwLjAyNTQ7XG4gICAgY29uc3QgZHkgPSAobG9jYWxQbGF5ZXIubG9jYWxPcmlnaW4udmFsdWUueSAtIG9yaWdpbi52YWx1ZS55KSAqIDAuMDI1NDtcbiAgICByZXR1cm4gTWF0aC5zcXJ0KE1hdGgucG93KGR4LCAyKSArIE1hdGgucG93KGR5LCAyKSkgPCB0aGlzLm1heGltdW1EaXN0YW5jZTtcbiAgfVxuXG4gIHByaXZhdGUgcmFuZ2UobG9jYWxQbGF5ZXI6IGFwcC5jb3JlLlBsYXllciwgb3JpZ2luOiBhcHAuY29yZS5WZWN0b3IpIHtcbiAgICBjb25zdCBkeCA9IChsb2NhbFBsYXllci5sb2NhbE9yaWdpbi52YWx1ZS54IC0gb3JpZ2luLnZhbHVlLngpICogMC4wMjU0O1xuICAgIGNvbnN0IGR5ID0gKGxvY2FsUGxheWVyLmxvY2FsT3JpZ2luLnZhbHVlLnkgLSBvcmlnaW4udmFsdWUueSkgKiAwLjAyNTQ7XG4gICAgcmV0dXJuIE1hdGguc3FydChNYXRoLnBvdyhkeCwgMikgKyBNYXRoLnBvdyhkeSwgMikpO1xuICB9XG59XG5cbmV4cG9ydCB0eXBlIElTZW5zZU9wdGlvbnMgPSB7XG4gIGxvbmdSYW5nZU1vZGU6IGJvb2xlYW47XG59XG4iXX0=