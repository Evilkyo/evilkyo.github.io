"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Runner = void 0;
const app = require("lib");
const ui = require("ui");
class Runner {
    constructor(canvas = document.getElementById('canvas'), map = new app.features.Map(canvas), radar = new app.features.Radar(canvas), recoil = new app.features.Recoil(), sense = new app.features.Sense()) {
        this.canvas = canvas;
        this.map = map;
        this.radar = radar;
        this.recoil = recoil;
        this.sense = sense;
    }
    static create() {
        const source = new Runner();
        source.attach();
        return source.run.bind(source);
    }
    run(core, vm) {
        const localPlayer = core.playerList.get(core.localPlayer.value);
        this.updateResearch(vm, localPlayer);
        this.updateSense(core, vm, localPlayer);
        this.canvas.height = window.innerHeight;
        this.canvas.width = window.innerWidth;
        this.update(core, vm, localPlayer);
    }
    attach() {
        this.canvas.addEventListener('dblclick', () => {
            (document.fullscreenElement
                ? document.exitFullscreen()
                : document.body.requestFullscreen()).catch();
        });
    }
    update(core, vm, localPlayer) {
        switch (vm.settings.general.viewType.value) {
            case ui.settings.general.MainType.Map:
                this.map.refresh(core.levelName.value);
                this.updateMap(core, vm, localPlayer);
                break;
            case ui.settings.general.MainType.Radar:
                this.radar.refresh();
                this.updateRadar(core, vm, localPlayer);
                break;
        }
    }
    updateMap(core, vm, localPlayer) {
        if (vm.settings.general.map.showItems.value)
            this.map.renderItems(core.itemList.values(), vm.settings.itemSet);
        if (vm.settings.general.map.showPlayers.value && localPlayer)
            this.map.renderPlayers(localPlayer, core.playerList.values());
    }
    updateRadar(core, vm, localPlayer) {
        if (vm.settings.general.radar.showItems.value && localPlayer)
            this.radar.renderItems(localPlayer, core.itemList.values(), vm.settings.itemSet);
        if (vm.settings.general.radar.showPlayers.value && localPlayer)
            this.radar.renderNpcs(localPlayer, core.npcList.values());
        if (vm.settings.general.radar.showPlayers.value && localPlayer)
            this.radar.renderPlayers(localPlayer, core.playerList.values());
    }
    updateResearch(vm, localPlayer) {
        if (vm.settings.research.recoil.enable.value && localPlayer && vm.settings.research.recoil.options)
            this.recoil.update(localPlayer, vm.settings.research.recoil.options);
    }
    updateSense(core, vm, localPlayer) {
        const itemsFn = vm.settings.general.sense.highlightItems.value
            ? this.sense.updateItems.bind(this.sense)
            : this.sense.resetItems.bind(this.sense);
        const playersFn = vm.settings.general.sense.highlightPlayers.value
            ? this.sense.updatePlayers.bind(this.sense)
            : this.sense.resetPlayers.bind(this.sense);
        if (localPlayer) {
            itemsFn(localPlayer, core.itemList.values(), vm.settings.itemSet);
            playersFn(localPlayer, core.playerList.values(), vm.settings.general.sense.options);
        }
    }
}
exports.Runner = Runner;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUnVubmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL1J1bm5lci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSwyQkFBMkI7QUFDM0IseUJBQXlCO0FBRXpCLE1BQWEsTUFBTTtJQUNqQixZQUNtQixTQUFTLFFBQVEsQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFzQixFQUMvRCxNQUFNLElBQUksR0FBRyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQ2xDLFFBQVEsSUFBSSxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFDdEMsU0FBUyxJQUFJLEdBQUcsQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLEVBQ2xDLFFBQVEsSUFBSSxHQUFHLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRTtRQUpoQyxXQUFNLEdBQU4sTUFBTSxDQUF5RDtRQUMvRCxRQUFHLEdBQUgsR0FBRyxDQUErQjtRQUNsQyxVQUFLLEdBQUwsS0FBSyxDQUFpQztRQUN0QyxXQUFNLEdBQU4sTUFBTSxDQUE0QjtRQUNsQyxVQUFLLEdBQUwsS0FBSyxDQUEyQjtJQUFHLENBQUM7SUFFdkQsTUFBTSxDQUFDLE1BQU07UUFDWCxNQUFNLE1BQU0sR0FBRyxJQUFJLE1BQU0sRUFBRSxDQUFDO1FBQzVCLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUNoQixPQUFPLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2pDLENBQUM7SUFFRCxHQUFHLENBQUMsSUFBbUIsRUFBRSxFQUFvQjtRQUMzQyxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hFLElBQUksQ0FBQyxjQUFjLENBQUMsRUFBRSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQ3JDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFB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RUFBRTtZQUNmLE9BQU8sQ0FBQyxXQUFXLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsRUFBRSxFQUFFLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ2xFLFNBQVMsQ0FBQyxXQUFXLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsRUFBRSxFQUFFLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDckY7SUFDSCxDQUFDO0NBQ0Y7QUE3RUQsd0JBNkVDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgYXBwIGZyb20gJ2xpYic7XG5pbXBvcnQgKiBhcyB1aSBmcm9tICd1aSc7XG5cbmV4cG9ydCBjbGFzcyBSdW5uZXIge1xuICBwcml2YXRlIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhcycpIGFzIEhUTUxDYW52YXNFbGVtZW50LFxuICAgIHByaXZhdGUgcmVhZG9ubHkgbWFwID0gbmV3IGFwcC5mZWF0dXJlcy5NYXAoY2FudmFzKSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHJhZGFyID0gbmV3IGFwcC5mZWF0dXJlcy5SYWRhcihjYW52YXMpLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgcmVjb2lsID0gbmV3IGFwcC5mZWF0dXJlcy5SZWNvaWwoKSxcbiAgICBwcml2YXRlIHJlYWRvbmx5IHNlbnNlID0gbmV3IGFwcC5mZWF0dXJlcy5TZW5zZSgpKSB7fVxuICBcbiAgc3RhdGljIGNyZWF0ZSgpIHtcbiAgICBjb25zdCBzb3VyY2UgPSBuZXcgUnVubmVyKCk7XG4gICAgc291cmNlLmF0dGFjaCgpO1xuICAgIHJldHVybiBzb3VyY2UucnVuLmJpbmQoc291cmNlKTtcbiAgfVxuXG4gIHJ1bihjb3JlOiBhcHAuY29yZS5Db3JlLCB2bTogdWkuTWFpblZpZXdNb2RlbCkge1xuICAgIGNvbnN0IGxvY2FsUGxheWVyID0gY29yZS5wbGF5ZXJMaXN0LmdldChjb3JlLmxvY2FsUGxheWVyLnZhbHVlKTtcbiAgICB0aGlzLnVwZGF0ZVJlc2VhcmNoKHZtLCBsb2NhbFBsYXllcik7XG4gICAgdGhpcy51cGRhdGVTZW5zZShjb3JlLCB2bSwgbG9jYWxQbGF5ZXIpO1xuICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbiAgICB0aGlzLmNhbnZhcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgIHRoaXMudXBkYXRlKGNvcmUsIHZtLCBsb2NhbFBsYXllcik7XG4gIH1cblxuICBwcml2YXRlIGF0dGFjaCgpIHtcbiAgICB0aGlzLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdkYmxjbGljaycsICgpID0+IHtcbiAgICAgIChkb2N1bWVudC5mdWxsc2NyZWVuRWxlbWVudFxuICAgICAgICA/IGRvY3VtZW50LmV4aXRGdWxsc2NyZWVuKClcbiAgICAgICAgOiBkb2N1bWVudC5ib2R5LnJlcXVlc3RGdWxsc2NyZWVuKCkpLmNhdGNoKCk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZShjb3JlOiBhcHAuY29yZS5Db3JlLCB2bTogdWkuTWFpblZpZXdNb2RlbCwgbG9jYWxQbGF5ZXI/OiBhcHAuY29yZS5QbGF5ZXIpIHtcbiAgICBzd2l0Y2ggKHZtLnNldHRpbmdzLmdlbmVyYWwudmlld1R5cGUudmFsdWUpIHtcbiAgICAgIGNhc2UgdWkuc2V0dGluZ3MuZ2VuZXJhbC5NYWluVHlwZS5NYXA6XG4gICAgICAgIHRoaXMubWFwLnJlZnJlc2goY29yZS5sZXZlbE5hbWUudmFsdWUpO1xuICAgICAgICB0aGlzLnVwZGF0ZU1hcChjb3JlLCB2bSwgbG9jYWxQbGF5ZXIpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgdWkuc2V0dGluZ3MuZ2VuZXJhbC5NYWluVHlwZS5SYWRhcjpcbiAgICAgICAgdGhpcy5yYWRhci5yZWZyZXNoKCk7XG4gICAgICAgIHRoaXMudXBkYXRlUmFkYXIoY29yZSwgdm0sIGxvY2FsUGxheWVyKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG4gIFxuICBwcml2YXRlIHVwZGF0ZU1hcChjb3JlOiBhcHAuY29yZS5Db3JlLCB2bTogdWkuTWFpblZpZXdNb2RlbCwgbG9jYWxQbGF5ZXI/OiBhcHAuY29yZS5QbGF5ZXIpIHtcbiAgICBpZiAodm0uc2V0dGluZ3MuZ2VuZXJhbC5tYXAuc2hvd0l0ZW1zLnZhbHVlKVxuICAgICAgdGhpcy5tYXAucmVuZGVySXRlbXMoY29yZS5pdGVtTGlzdC52YWx1ZXMoKSwgdm0uc2V0dGluZ3MuaXRlbVNldCk7XG4gICAgaWYgKHZtLnNldHRpbmdzLmdlbmVyYWwubWFwLnNob3dQbGF5ZXJzLnZhbHVlICYmIGxvY2FsUGxheWVyKVxuICAgICAgdGhpcy5tYXAucmVuZGVyUGxheWVycyhsb2NhbFBsYXllciwgY29yZS5wbGF5ZXJMaXN0LnZhbHVlcygpKTtcbiAgfVxuICBcbiAgcHJpdmF0ZSB1cGRhdGVSYWRhcihjb3JlOiBhcHAuY29yZS5Db3JlLCB2bTogdWkuTWFpblZpZXdNb2RlbCwgbG9jYWxQbGF5ZXI/OiBhcHAuY29yZS5QbGF5ZXIpIHtcbiAgICBpZiAodm0uc2V0dGluZ3MuZ2VuZXJhbC5yYWRhci5zaG93SXRlbXMudmFsdWUgJiYgbG9jYWxQbGF5ZXIpXG4gICAgICB0aGlzLnJhZGFyLnJlbmRlckl0ZW1zKGxvY2FsUGxheWVyLCBjb3JlLml0ZW1MaXN0LnZhbHVlcygpLCB2bS5zZXR0aW5ncy5pdGVtU2V0KTtcbiAgICBpZiAodm0uc2V0dGluZ3MuZ2VuZXJhbC5yYWRhci5zaG93UGxheWVycy52YWx1ZSAmJiBsb2NhbFBsYXllcilcbiAgICAgIHRoaXMucmFkYXIucmVuZGVyTnBjcyhsb2NhbFBsYXllciwgY29yZS5ucGNMaXN0LnZhbHVlcygpKTtcbiAgICBpZiAodm0uc2V0dGluZ3MuZ2VuZXJhbC5yYWRhci5zaG93UGxheWVycy52YWx1ZSAmJiBsb2NhbFBsYXllcilcbiAgICAgIHRoaXMucmFkYXIucmVuZGVyUGxheWVycyhsb2NhbFBsYXllciwgY29yZS5wbGF5ZXJMaXN0LnZhbHVlcygpKTtcbiAgfVxuICBcbiAgcHJpdmF0ZSB1cGRhdGVSZXNlYXJjaCh2bTogdWkuTWFpblZpZXdNb2RlbCwgbG9jYWxQbGF5ZXI/OiBhcHAuY29yZS5QbGF5ZXIpIHtcbiAgICBpZiAodm0uc2V0dGluZ3MucmVzZWFyY2gucmVjb2lsLmVuYWJsZS52YWx1ZSAmJiBsb2NhbFBsYXllciAmJiB2bS5zZXR0aW5ncy5yZXNlYXJjaC5yZWNvaWwub3B0aW9ucylcbiAgICAgIHRoaXMucmVjb2lsLnVwZGF0ZShsb2NhbFBsYXllciwgdm0uc2V0dGluZ3MucmVzZWFyY2gucmVjb2lsLm9wdGlvbnMpO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVTZW5zZShjb3JlOiBhcHAuY29yZS5Db3JlLCB2bTogdWkuTWFpblZpZXdNb2RlbCwgbG9jYWxQbGF5ZXI/OiBhcHAuY29yZS5QbGF5ZXIpIHtcbiAgICBjb25zdCBpdGVtc0ZuID0gdm0uc2V0dGluZ3MuZ2VuZXJhbC5zZW5zZS5oaWdobGlnaHRJdGVtcy52YWx1ZVxuICAgICAgPyB0aGlzLnNlbnNlLnVwZGF0ZUl0ZW1zLmJpbmQodGhpcy5zZW5zZSlcbiAgICAgIDogdGhpcy5zZW5zZS5yZXNldEl0ZW1zLmJpbmQodGhpcy5zZW5zZSk7XG4gICAgY29uc3QgcGxheWVyc0ZuID0gdm0uc2V0dGluZ3MuZ2VuZXJhbC5zZW5zZS5oaWdobGlnaHRQbGF5ZXJzLnZhbHVlXG4gICAgICA/IHRoaXMuc2Vuc2UudXBkYXRlUGxheWVycy5iaW5kKHRoaXMuc2Vuc2UpXG4gICAgICA6IHRoaXMuc2Vuc2UucmVzZXRQbGF5ZXJzLmJpbmQodGhpcy5zZW5zZSk7XG4gICAgaWYgKGxvY2FsUGxheWVyKSB7XG4gICAgICBpdGVtc0ZuKGxvY2FsUGxheWVyLCBjb3JlLml0ZW1MaXN0LnZhbHVlcygpLCB2bS5zZXR0aW5ncy5pdGVtU2V0KTtcbiAgICAgIHBsYXllcnNGbihsb2NhbFBsYXllciwgY29yZS5wbGF5ZXJMaXN0LnZhbHVlcygpLCB2bS5zZXR0aW5ncy5nZW5lcmFsLnNlbnNlLm9wdGlvbnMpO1xuICAgIH1cbiAgfVxufVxuIl19